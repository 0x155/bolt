{% set repeatfieldvals = context.content.get('contentkey') %}
{% set labelkey = field.label ?: key|ucfirst %}

<fieldset class="repeater-wrapper" data-bolt-field="repeater">
    <legend class="sr-only">{{ labelkey }}</legend>
    <label class="main col-xs-12">{{ labelkey }}</label>
    <div class="repeater-slot">

        <script type="text/template" id="{{ name }}_template">
            <div class="repeater-group">
                {% for rkey, rfield in field.fields %}
                    {% set rlabelkey = rfield.label ?: rkey|ucfirst %}
                    <div class="col-xs-12">
                        {% include context.fields[rfield.type].template with {
                            'key': rkey,
                            'name': name ~ '['~index~'][' ~ rkey ~ '][]',
                            'contentkey': rkey,
                            'field': rfield,
                            'labelkey': rlabelkey
                        } %}
                    </div>
                {% endfor %}
            </div>
        </script>

        {# In cases where we don't have any values set, the we show a single set of fields by default #}
        {% if not repeatfieldvals.length %}
            <div class="repeater-group row panel panel-default">
                <div class="panel-heading">
                    <div class="btn-group text-right">
                        <button type="button" class="btn btn-silent-danger">
                            <i class="fa fa-trash"></i> Delete
                        </button>

                    </div>
                </div>
                {% for rkey, rfield in field.fields %}
                    {% set rlabelkey = rfield.label ?: rkey|ucfirst %}
                    <div class="col-xs-12">
                        {% include context.fields[rfield.type].template with {
                            'key': rkey,
                            'name': name ~ '['~index~'][' ~ rkey ~ '][]',
                            'contentkey': rkey,
                            'field': rfield,
                            'labelkey': rlabelkey
                        } %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            {% for repeatfieldset in repeatfieldvals %}

            {% endfor %}
        {% endif %}
    </div>

    <div class="repeater-add">
        <a class="btn btn-default" href="#">
            <i class="fa fa-plus"></i> New {{ labelkey }}
        </a>
    </div>
</fieldset>
