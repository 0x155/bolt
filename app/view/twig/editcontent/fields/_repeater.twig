{% extends '@bolt/_base/_fieldset.twig' %}

{% set repeatfields = context.content.get('contentkey') %}
{% set labelkey = field.label ?: key|ucfirst %}

{% block fieldset_type 'repeater' %}
{% block fieldset_label_text  labelkey %}
{% block fieldset_label_info  field.info|default('') %}
{% block fieldset_label_class 'col-xs-12' %}

{% block fieldset_controls %}
    {{ dump(field.fields) }}
    <script type="text/template">
        {% for rkey, rfield in field.fields %}
            {% include context.fields[rfield.type].template with {
                'key': rkey,
                'name': name ~ '[__index__][' ~ rkey ~ '][]',
                'contentkey': rkey,
                'field': rfield
            } %}
        {% endfor %}
    </script>
    {% if not repeatfields.length %}
        {% for rkey, rfield in field.fields %}
            {% include context.fields[rfield.type].template with {
                'key': rkey,
                'name': name ~ '[0][' ~ rkey ~ ']',
                'contentkey': rkey,
                'field': rfield
            } %}
        {% endfor %}
    {% endif %}
{% endblock fieldset_controls %}