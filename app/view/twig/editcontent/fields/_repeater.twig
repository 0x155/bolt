{% set repeatfieldvals = context.content.get('contentkey') %}
{% set labelkey = field.label ?: key|ucfirst %}

{% extends '@bolt/_base/_fieldset.twig' %}

{% block fieldset_type 'repeater' %}

{% block fieldset_label_text  labelkey %}
{% block fieldset_label_info  option.info %}
{% block fieldset_label_class 'col-xs-12' %}

{% block fieldset_controls %}
    <div class="repeater-wrapper">
        <div class="repeater-add">
            <a class="btn btn-default" href="#">
                <i class="fa fa-plus"></i> New {{ labelkey }}
            </a>
        </div>

        <div class="repeater-slot"></div>

            <script type="text/template" id="{{ name }}_template">
                {% for rkey, rfield in field.fields %}
                    {% set labelkey = rfield.label ?: rkey|ucfirst %}
                    <div class="col-xs-12 repeater-group">
                        {% include context.fields[rfield.type].template with {
                            'key': rkey,
                            'name': name ~ '['~index~'][' ~ rkey ~ '][]',
                            'contentkey': rkey,
                            'field': rfield,
                            'labelkey': labelkey
                        } %}
                    </div>
                {% endfor %}
            </script>

            {# In cases where we don't have any values set, the we show a single set of fields by default #}
            {% if not repeatfieldvals.length %}
                {% for rkey, rfield in field.fields %}
                    {% set labelkey = rfield.label ?: rkey|ucfirst %}
                    <div class="col-xs-12 repeater-group">
                        {% include context.fields[rfield.type].template with {
                            'key': rkey,
                            'name': name ~ '['~index~'][' ~ rkey ~ '][]',
                            'contentkey': rkey,
                            'field': rfield,
                            'labelkey': labelkey
                        } %}
                    </div>
                {% endfor %}
            {% else %}
                {% for repeatfieldset in repeatfieldvals %}

                {% endfor %}
            {% endif %}
        </div>
    </div>

{% endblock %}