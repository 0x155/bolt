{% extends '@bolt/_base/_fieldset.twig' %}

{% set repeatfields = context.content.get('contentkey') %}
{% set labelkey = field.label ?: key|ucfirst %}

{% block fieldset_type 'repeater' %}
{% block fieldset_label_text  labelkey %}
{% block fieldset_label_info  field.info|default('') %}
{% block fieldset_label_class 'col-xs-12' %}

{% macro repeatfields(index) %}
    {% for rkey, rfield in field.fields %}
        {% set field = field|merge({'label': rfield.label ?: rkey|ucfirst })%}
        {% include context.fields[rfield.type].template with {
            'key': rkey,
            'name': name ~ '['~index~'][' ~ rkey ~ '][]',
            'contentkey': rkey,
            'field': rfield,
            'label': rfield.label ?: rkey|ucfirst
        } %}
    {% endfor %}
{% endmacro %}

{% block fieldset_controls %}
    <script type="text/template">
        {{ repeatfields('__index__') }}
    </script>

    # In cases where we don't have any values set, the we show a single set of fields by default
    {% if not repeatfields.length %}
        {{ repeatfields('0') }}
    {% endif %}
{% endblock fieldset_controls %}