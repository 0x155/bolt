{% set repeatfieldvals = context.content.get('contentkey') %}
{% set labelkey = field.label ?: key|ucfirst %}



{% macro repeatfields(field, name, context, index) %}
    {% for rkey, rfield in field.fields %}
        {% set labelkey = rfield.label ?: rkey|ucfirst %}
        <div data-fieldtype="{{ rfield.type }}">
            {% include context.fields[rfield.type].template with {
                'key': rkey,
                'name': name ~ '['~index~'][' ~ rkey ~ '][]',
                'contentkey': rkey,
                'field': rfield,
                'labelkey': labelkey
            } %}
        </div>
    {% endfor %}
{% endmacro %}

<fieldset class="form-group" data-bolt-field="repeater">
    <legend class="sr-only">{{ labelkey }}</legend>
    <label class="main col-xs-12">{{ labelkey }}</label>
</fieldset>

<div class="col-xs-12">

    <script type="text/template" id="{{ name }}_template">
        {{ _self.repeatfields(field, name, context, '__index__') }}
    </script>

    {# In cases where we don't have any values set, the we show a single set of fields by default #}
    {% if not repeatfields.length %}
        <div class="repeater-fieldset">
            {{ _self.repeatfields(field, name, context, '0') }}
        </div>
    {% endif %}
</div>
