{#=== OPTIONS ========================================================================================================#}

{% set option = {
    class:       ('form-control ' ~ field.class)|trim,
    label:       field.label,
    extensions:  field.extensions|default([]),
    upload:      field.upload|default(''),
    can_upload:  field.canUpload,
    info:        field.info|default('info.upload.file')
} %}

{#=== INIT ===========================================================================================================#}

{% set attributes = {
    filepath: {
        class:        option.class ~ ' imageinput',
        id:           'field-' ~ key,
        name:         name,
        placeholder:  __('field.general.allowed-filetypes') ~ ' ' ~ option.extensions|join(', ') ~ ' â€¦',
        type:         'text',
        value:        context.content.get(contentkey),
    },

    upload: {
        accept:       option.extensions ? '.' ~ option.extensions|join(',.') : '',
        data_upload:  {type: 'File', key: key}|json_encode(),
        data_url:     url('upload', {'handler': option.upload}),
        id:           'fileupload-' ~ key,
        name:         'files[]',
        type:         'file',
    }
} %}

{#=== BLOCKS =========================================================================================================#}

{% import _self as block %}

{% macro progress(key) %}
    <div class="progress file-progress progress-striped active" id="progress-{{ key }}">
        <div class="progress-bar" style="width: 0%;"></div>
    </div>
{% endmacro %}

{# Modal "select from server" #}
{% macro serverselect(key) %}
    <div class="modal fade" id="selectModal-{{ key }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content"></div>
        </div>
    </div>
{% endmacro %}

{#=== FIELDSET =======================================================================================================#}

{% extends '_base/_fieldset.twig' %}

{% block fieldset_type 'file' %}

{% block fieldset_label %}
    <label class="col-sm-12">{{ (option.info) ? macro.infopop(labelkey, option.info) : labelkey }}</label>
{% endblock fieldset_label %}

{% block fieldset_controls %}
    <div class="col-sm-12 dropzone clearfix" id="dropzone-{{ key }}">
        <input{{ macro.attr(attributes.filepath) }}>
        {% set can_upload = context.can_upload and option.can_upload %}
        {{ macro.upload_buttons('file', key, attributes.upload, option.upload, can_upload) }}
        {{ block.progress(key) }}
        {{ block.serverselect(key, __('Cancel')) }}

        {% if not ismobileclient() %}
            <div style="clear: left;" class="hidden-xs">
                <small>{{ app.translator.trans('info.upload.filesmall', {}, 'infos') }}</small>
            </div>
        {% endif %}
    </div>
{% endblock fieldset_controls %}
