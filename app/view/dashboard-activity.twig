{% import '_sub_crosslinks.twig' as crosslinks %}

<section class="news">
    <h2>{{ __('Latest activity') }}</h2>
    <ul class='activity'>
{% for log in activity %}
    {% if attribute(users, log.username) is defined %}
        {% set userlink = crosslinks.userlink(attribute(users, log.username)) %}
    {% else %}
        {% set userlink = 'unknown' %}
    {% endif %}
    <li>
        {%  if log.code == "save content" %}
            {% if app.config.get('contenttypes')[log.contenttype] is defined %}
                {% set contenttype = app.config.get('contenttypes')[log.contenttype] %}
                {% set contenttype_display_name = contenttype.singular_name %}
                {% set content_display_name = crosslinks.contentlink_by_id(contenttype, log.message, log.content_id) %}
            {% else %}
                {% set contenttype_display_name = log.contenttype %}
                {% set content_display_name = log.message %}
            {% endif %}

            Saved {{ contenttype_display_name }}
            "<strong>{{ content_display_name }}</strong>" by <em>{{ userlink }}</em>
        {%  elseif log.code == "login" %}
            <em>{{ userlink }}</em> logged in
        {%  elseif log.code == "logout" %}
            <em>{{ userlink }}</em> logged out
        {%  elseif log.code == "fixme" %}
            <b>Fixme:</b> {{ log.message }}
        {%  elseif log.code == "user" %}
            <b>{{ log.message }}</b> by {{ userlink }}
        {%  else %}
            {{ log.message }}
        {%  endif %}
        <small>(<time class="moment" datetime="{{ log.date|date("c") }}" title="{{ log.date }}">{{ log.date }}</time>)</small>
    </li>
{%  endfor %}
    </ul>

    <p>&nbsp;<a href="{{ path('activitylog') }}" class="morelink">{{ __('more activity') }} Â»</a></p>

</section>

